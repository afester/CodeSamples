<!DOCTYPE html>

<!--
<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
-->

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
      <title>JavaScript samples</title>
  </head>

  <body onload="initialize();">
  
    <script>
    function getFormula() {
    	var result = formula.value;

    	result = result.replace("sin", "Math.sin");
    	result = result.replace("cos", "Math.cos");
    	result = result.replace("tan", "Math.tan");

    	return result;
    }

    function updateValues() {
    	var xRange = toX.value - fromX.value;
    	startY = -(xRange * 460) / (2 * 620);
    	stopY = -startY;

    	fromY.childNodes[0].data = startY;  // note: child node must exist!
    	toY.childNodes[0].data = stopY;     // note: child node must exist!

    	startX = parseFloat(fromX.value);
        stopX = toX.value;
        

        scalePerPixel = (stopX - startX) / 620;

        x0pos = -startX / scalePerPixel + 10;
        y0pos = -fromY.childNodes[0].data / scalePerPixel + 10;
    }


    function drawAxis() {
        context.moveTo(x0pos, 0);
        context.lineTo(x0pos, 470);    // Y axis
        context.moveTo(10, y0pos);
        context.lineTo(630, y0pos);   // X axis

        // TODO:  Fix tick calculation!
        var mag = 620 / 20 * scalePerPixel;
        if (mag > 50) {
            tick = 1000;
        } else if (mag > 5) {
            tick = 100;
        } else if (mag > 0.5) {
            tick = 10;
        } else if (mag > 0.05) {
            tick = 1;
        } else if (mag > 0.005) {
            tick = 0.1;
        } else {
            alert("INVALID SCALE!")    // TODO ...
        }

        // draw the y scale
        for (var y = -tick; y > startY; y -= tick) {
        	ypos = y0pos - y / scalePerPixel;
        	context.moveTo(x0pos - 5, ypos); context.lineTo(x0pos + 5, ypos);
        }
        for (var y = tick; y < stopY; y += tick) {
            // context.strokeText("X", 0, y + 3);
            ypos = y0pos - y / scalePerPixel;
            context.moveTo(x0pos - 5, ypos); context.lineTo(x0pos + 5, ypos);
        }

        // draw the x scale
        for (var x = -tick; x > startX; x -= tick) {
            xpos = x0pos + x / scalePerPixel;
            context.moveTo(xpos, y0pos - 5); context.lineTo(xpos, y0pos + 5);
        }
        for (var x = tick; x < stopX; x += tick) {
        	xpos = x0pos + x / scalePerPixel;
            context.moveTo(xpos, y0pos - 5); context.lineTo(xpos, y0pos + 5);
        }

        context.stroke();
    }

    function drawGraph() {
        // draw the graph
        var x = startX;
        y = eval(theFormula);
        if (y == Infinity) {
            y = 1000;
        }
        xpos = x0pos + x / scalePerPixel;
        ypos = y0pos - y / scalePerPixel;
        context.moveTo(xpos, ypos);
        x += scalePerPixel;
    
        for (var x = startX + scalePerPixel;  x < stopX;  x += scalePerPixel) {
            y = eval(theFormula);
    
            xpos = x0pos + x / scalePerPixel;
            ypos = y0pos - y / scalePerPixel;
    
            context.lineTo(xpos, ypos);
        }
        context.stroke();
    }

    function calculate() {
        theFormula = getFormula();
        drawGraph();
    }
    
    function reset() {
        updateValues();
        canvas.width = canvas.width; // seems not to work on all browsers, see
        // http://stackoverflow.com/questions/2142535/how-to-clear-the-canvas-for-redrawing
        // context.clearRect(0, 0, canvas.width, canvas.height); // However, this did not work for me ...

        drawAxis();
    }

    function initialize() {
    	context = canvas.getContext('2d');
    	reset();
    }

    </script>

    <p><button onclick="myFunction()">Alert Box</button></p>
    <p><a href="" onclick="myFunction()">Alert Box</a></p>

    <hr/>

    <!-- <p><label>Formula: </label><input id="formula" value="2*sin(x)+2" /></p> -->
    <p><label>f(x) = </label><input id="formula" value="2*sin(x)" />
       <button onclick="calculate()">Draw graph</button></p>

    <p><label>X axis: from: </label><input id="fromX" value="-3.15" />
       <label>to: </label><input id="toX" value="6.3" />
       <button onclick="reset()">Reset</button></p>

    <p><label>Y axis: from: </label> <label id="fromY">0</label> <label>to: </label> <label id="toY">0</label></p>

    <canvas onload="reset()" id="canvas" width="640" height="480" style="background:lightgray"></canvas> 
  </body>
</html>
